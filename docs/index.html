<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finance News Archive</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: system-ui, Arial, sans-serif; margin: 20px; }
  h1 { font-size: 1.4rem; margin-bottom: 0.5rem; }
  .controls { display: flex; gap: 8px; align-items: center; margin-bottom: 16px; }
  select, button { padding: 6px 8px; }
  .news-item { border-bottom: 1px solid #e5e7eb; padding: 10px 0; }
  .news-content { display: flex; gap: 10px; align-items: flex-start; }
  .thumb { width: 120px; height: 90px; object-fit: cover; border-radius: 6px; background:#f3f4f6; }
  .title { font-weight: 600; text-decoration: none; color: #111827; }
  .title:hover { text-decoration: underline; }
  .meta { color: #6b7280; font-size: 0.88rem; margin-top: 4px; }
  #status { color:#6b7280; margin-bottom:8px; }
</style>
</head>
<body>

<h1>Finance News Archive</h1>
<div class="controls">
  <label for="dateSelect">Date:</label>
  <select id="dateSelect"></select>
  <button id="btnLatest" type="button">Go to latest</button>
</div>
<div id="status"></div>
<div id="newsList"></div>

<script>
const dateSelect = document.getElementById('dateSelect');
const newsList   = document.getElementById('newsList');
const statusEl   = document.getElementById('status');
const btnLatest  = document.getElementById('btnLatest');

async function fetchJSON(url) {
  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error(`HTTP ${res.status} for ${url}`);
  return res.json();
}

async function loadIndex() {
  statusEl.textContent = 'Loading dates…';
  const idx = await fetchJSON('news/index.json'); // { dates: ["MM-dd-YYYY", ...] }
  const dates = Array.isArray(idx.dates) ? idx.dates : [];
  dateSelect.innerHTML = '';
  dates.forEach(d => {
    const opt = document.createElement('option');
    opt.value = d;
    opt.textContent = d;
    dateSelect.appendChild(opt);
  });
  statusEl.textContent = dates.length ? `Found ${dates.length} day(s)` : 'No dates found';
  if (dates.length) {
    dateSelect.value = dates[0];    // pick latest
    await loadDay(dates[0]);
  } else {
    newsList.innerHTML = '';
  }
}

async function loadDay(dateStr) {
  statusEl.textContent = `Loading ${dateStr}…`;
  newsList.innerHTML = '';
  try {
    const data = await fetchJSON(`news/${dateStr}.json`);
    const items = Object.values(data).sort((a,b)=> (a.published < b.published ? 1 : -1));
    if (!items.length) {
      newsList.innerHTML = '<p>No items for this date.</p>';
      statusEl.textContent = 'Done';
      return;
    }
    const frag = document.createDocumentFragment();
    items.forEach(item => {
      const div = document.createElement('div');
      div.className = 'news-item';
      const imgHTML = item.image ? `<img class="thumb" src="${item.image}" alt="">` : '';
      const dt = new Date(item.published);
      div.innerHTML = `
        <div class="news-content">
          ${imgHTML}
          <div>
            <a class="title" href="${item.link}" target="_blank" rel="noopener">${item.title}</a>
            <div class="meta">${item.source} • ${dt.toLocaleString()}</div>
          </div>
        </div>
      `;
      frag.appendChild(div);
    });
    newsList.appendChild(frag);
    statusEl.textContent = `Loaded ${items.length} item(s)`;
  } catch (e) {
    statusEl.textContent = '';
    newsList.innerHTML = `<p style="color:#b91c1c">Error: ${e.message}</p>`;
  }
}

dateSelect.addEventListener('change', () => loadDay(dateSelect.value));
btnLatest.addEventListener('click', async () => {
  try {
    const latest = await fetchJSON('news/latest.json'); // { date, items, generated_at }
    if (latest && latest.date) {
      dateSelect.value = latest.date;
      await loadDay(latest.date);
    }
  } catch (e) {
    alert('Cannot load latest.json yet.');
  }
});

loadIndex();
</script>

</body>
</html>
